/*
 * Decompiled with CFR 0.152.
 */
package me.moon.module.impl.exploit;

import java.awt.Color;
import me.moon.Moon;
import me.moon.event.Handler;
import me.moon.event.impl.game.PacketEvent;
import me.moon.event.impl.game.TickEvent;
import me.moon.event.impl.player.UpdateEvent;
import me.moon.module.Module;
import me.moon.module.impl.movement.Flight;
import me.moon.module.impl.movement.Speed;
import me.moon.utils.game.TimerUtil;
import me.moon.utils.value.impl.EnumValue;
import me.moon.utils.value.impl.NumberValue;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.server.S12PacketEntityVelocity;

public class Regen
extends Module {
    private boolean teleport;
    private boolean teleported;
    private boolean sendBack;
    private boolean shouldHeal;
    private double prevX;
    private double prevY;
    private double prevZ;
    private float preYaw;
    private float prePitch;
    private int moveUnder;
    private final TimerUtil timerUtil = new TimerUtil();
    private int velocityTicks;
    private final EnumValue<Mode> mode = new EnumValue<Mode>("Mode", Mode.Normal);
    private final NumberValue<Float> speed = new NumberValue<Float>("Speed", Float.valueOf(25.0f), Float.valueOf(1.0f), Float.valueOf(100.0f), Float.valueOf(1.0f));

    public Regen() {
        super("Regen", Module.Category.EXPLOITS, new Color(5090969).getRGB());
        this.setDescription("Regenerate health.");
    }

    @Override
    public void onEnable() {
        this.sendBack = false;
        this.teleported = false;
        this.teleport = false;
        this.prevZ = 0.0;
        this.prevY = 0.0;
        this.prevX = 0.0;
    }

    @Handler(value=UpdateEvent.class)
    public void onUpdate(UpdateEvent event) {
        if (this.mc.thePlayer == null) {
            return;
        }
        switch ((Mode)((Object)this.mode.getValue())) {
            case Normal: {
                if (!event.isPre()) break;
                Flight flight = (Flight)Moon.INSTANCE.getModuleManager().getModule("Flight");
                Speed speedModule = (Speed)Moon.INSTANCE.getModuleManager().getModule("Speed");
                if (!(this.mc.thePlayer.getHealth() < this.mc.thePlayer.getMaxHealth()) || !this.mc.thePlayer.onGround || flight.isEnabled() || Speed.mode.getValue() == Speed.Mode.VERUS && speedModule.isEnabled()) break;
                int i = 0;
                while ((float)i < ((Float)this.speed.getValue()).floatValue()) {
                    this.mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(this.mc.thePlayer.posX, this.mc.thePlayer.posY, this.mc.thePlayer.posZ, this.mc.thePlayer.onGround));
                    ++i;
                }
                break;
            }
            case Experimental: {
                if (!event.isPre() || !(this.mc.thePlayer.getHealth() < this.mc.thePlayer.getMaxHealth() - 3.0f) || this.mc.thePlayer.getFoodStats().getFoodLevel() <= 17 || !this.mc.thePlayer.onGround || this.velocityTicks <= 8) break;
                int i = 0;
                while ((float)i < ((Float)this.speed.getValue()).floatValue()) {
                    this.mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(this.mc.thePlayer.posX, this.mc.thePlayer.posY, this.mc.thePlayer.posZ, true));
                    ++i;
                }
                break;
            }
        }
    }

    @Handler(value=PacketEvent.class)
    public void onPacket(PacketEvent event) {
        switch ((Mode)((Object)this.mode.getValue())) {
            case Experimental: {
                S12PacketEntityVelocity packet;
                if (event.isSending()) {
                    if (!(event.getPacket() instanceof C03PacketPlayer)) break;
                    ++this.velocityTicks;
                    break;
                }
                if (!(event.getPacket() instanceof S12PacketEntityVelocity) || (packet = (S12PacketEntityVelocity)event.getPacket()).getEntityID() != this.mc.thePlayer.getEntityId()) break;
                this.velocityTicks = 0;
                break;
            }
        }
    }

    @Handler(value=TickEvent.class)
    public void onTick(TickEvent event) {
    }

    private boolean canHeal() {
        return this.mc.thePlayer.getHealth() < 20.0f && this.mc.thePlayer.getFoodStats().getFoodLevel() >= 19 && this.mc.thePlayer.onGround;
    }

    public static enum Mode {
        Normal,
        Experimental;

    }
}

