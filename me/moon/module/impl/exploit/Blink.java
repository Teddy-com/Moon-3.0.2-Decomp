/*
 * Decompiled with CFR 0.152.
 * 
 * Could not load the following classes:
 *  javax.vecmath.Vector3d
 *  org.lwjgl.opengl.GL11
 */
package me.moon.module.impl.exploit;

import java.awt.Color;
import java.util.ArrayList;
import javax.vecmath.Vector3d;
import me.moon.event.Handler;
import me.moon.event.impl.game.PacketEvent;
import me.moon.event.impl.render.Render3DEvent;
import me.moon.module.Module;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.network.Packet;
import org.lwjgl.opengl.GL11;

public class Blink
extends Module {
    private final ArrayList<Packet> packets = new ArrayList();
    private final ArrayList<Vector3d> locations = new ArrayList();

    public Blink() {
        super("Blink", Module.Category.EXPLOITS, new Color(246, 255, 146).getRGB());
        this.setDescription("Cancel all packets and then send them on disable");
    }

    @Handler(value=PacketEvent.class)
    public void onPacket(PacketEvent event) {
        if (this.mc.thePlayer == null || !event.isSending()) {
            return;
        }
        if (this.hasMoved()) {
            this.locations.add(new Vector3d(this.mc.thePlayer.posX, this.mc.thePlayer.posY, this.mc.thePlayer.posZ));
        }
        this.packets.add(event.getPacket());
        event.setCancelled(true);
    }

    @Handler(value=Render3DEvent.class)
    public void onRender(Render3DEvent event) {
        if (this.mc.thePlayer == null) {
            return;
        }
        if (!this.locations.isEmpty()) {
            GL11.glPushMatrix();
            GL11.glLineWidth((float)3.0f);
            GL11.glDisable((int)2929);
            GL11.glDisable((int)3553);
            GL11.glColor3d((double)1.0, (double)1.0, (double)1.0);
            GL11.glEnable((int)2848);
            GL11.glEnable((int)3042);
            GL11.glBlendFunc((int)770, (int)771);
            GL11.glBegin((int)3);
            this.locations.forEach(vector -> GL11.glVertex3d((double)(vector.x - this.mc.getRenderManager().renderPosX), (double)(vector.y - this.mc.getRenderManager().renderPosY), (double)(vector.z - this.mc.getRenderManager().renderPosZ)));
            GL11.glEnd();
            GL11.glDisable((int)3042);
            GL11.glDisable((int)2848);
            GL11.glEnable((int)3553);
            GL11.glEnable((int)2929);
            GL11.glPopMatrix();
        }
    }

    @Override
    public void onEnable() {
        if (this.mc.theWorld == null) {
            return;
        }
        EntityOtherPlayerMP entityOtherPlayerMP = new EntityOtherPlayerMP(this.mc.theWorld, this.mc.thePlayer.getGameProfile());
        entityOtherPlayerMP.inventory = this.mc.thePlayer.inventory;
        entityOtherPlayerMP.inventoryContainer = this.mc.thePlayer.inventoryContainer;
        entityOtherPlayerMP.setPositionAndRotation(this.mc.thePlayer.posX, this.mc.thePlayer.getEntityBoundingBox().minY, this.mc.thePlayer.posZ, this.mc.thePlayer.rotationYaw, this.mc.thePlayer.rotationPitch);
        entityOtherPlayerMP.rotationYawHead = this.mc.thePlayer.rotationYawHead;
        entityOtherPlayerMP.setSneaking(this.mc.thePlayer.isSneaking());
        this.mc.theWorld.addEntityToWorld(-13376969, entityOtherPlayerMP);
        this.packets.clear();
    }

    @Override
    public void onDisable() {
        if (this.mc.theWorld == null) {
            return;
        }
        this.mc.theWorld.removeEntityFromWorld(-13376969);
        this.packets.forEach(this.mc.thePlayer.sendQueue.getNetworkManager()::sendPacket);
        this.packets.clear();
        this.locations.clear();
    }

    private boolean hasMoved() {
        return this.mc.thePlayer.posX != this.mc.thePlayer.prevPosX || this.mc.thePlayer.posY != this.mc.thePlayer.prevPosY || this.mc.thePlayer.posZ != this.mc.thePlayer.prevPosZ;
    }
}

