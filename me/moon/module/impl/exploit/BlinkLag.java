/*
 * Decompiled with CFR 0.152.
 * 
 * Could not load the following classes:
 *  javax.vecmath.Vector3d
 *  org.apache.commons.lang3.StringUtils
 */
package me.moon.module.impl.exploit;

import java.awt.Color;
import java.util.ArrayList;
import javax.vecmath.Vector3d;
import me.moon.Moon;
import me.moon.event.Handler;
import me.moon.event.impl.game.PacketEvent;
import me.moon.event.impl.render.Render2DEvent;
import me.moon.module.Module;
import me.moon.module.impl.movement.Flight;
import me.moon.utils.MathUtils;
import me.moon.utils.value.impl.BooleanValue;
import me.moon.utils.value.impl.NumberValue;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.network.Packet;
import org.apache.commons.lang3.StringUtils;

public class BlinkLag
extends Module {
    private final ArrayList<Packet> packets = new ArrayList();
    private final ArrayList<Vector3d> locations = new ArrayList();
    private boolean isEnabled;
    private int elapsed;
    private final NumberValue<Integer> delay = new NumberValue<Integer>("Delay", 5, 2, 200, 1);
    private final BooleanValue hypixel = new BooleanValue("Watchdog", true);

    public BlinkLag() {
        super("BlinkLag", Module.Category.EXPLOITS, new Color(246, 255, 146).getRGB());
        this.setDescription("Cancel all packets and then send them on timings");
    }

    @Handler(value=PacketEvent.class)
    public void onPacket(PacketEvent event) {
        if (this.hypixel.getValue().booleanValue()) {
            if (!Moon.INSTANCE.getModuleManager().getModule("Flight").isEnabled()) {
                this.toggle();
            }
            Flight flight = (Flight)Moon.INSTANCE.getModuleManager().getModule("Flight");
            if (!flight.hasDamaged) {
                // empty if block
            }
        }
        if (this.mc.thePlayer == null || !event.isSending()) {
            return;
        }
        this.setSuffix(StringUtils.capitalize((String)((Integer)this.delay.getValue()).toString()));
        if (this.mc.thePlayer.ticksExisted % (Integer)this.delay.getValue() != 0 && !this.mc.thePlayer.isDead) {
            if (!this.isEnabled) {
                this.isEnabled = true;
                if (this.mc.theWorld == null) {
                    return;
                }
                this.packets.clear();
                this.elapsed = MathUtils.getRandomInRange(2, 3);
            }
        } else {
            this.elapsed = 0;
            this.isEnabled = false;
            if (this.mc.theWorld == null) {
                return;
            }
            this.packets.forEach(this.mc.thePlayer.sendQueue.getNetworkManager()::sendPacket);
            this.packets.clear();
            this.elapsed = MathUtils.getRandomInRange(2, 3);
        }
        if (this.isEnabled) {
            ++this.elapsed;
            this.packets.add(event.getPacket());
            event.setCancelled(true);
        }
    }

    @Handler(value=Render2DEvent.class)
    public void onRender(Render2DEvent event) {
        if (this.hypixel.getValue().booleanValue()) {
            Flight flight = (Flight)Moon.INSTANCE.getModuleManager().getModule("Flight");
            if (!flight.hasDamaged) {
                // empty if block
            }
        }
        if (this.mc.thePlayer == null) {
            return;
        }
    }

    @Override
    public void onEnable() {
        if (this.mc.theWorld == null) {
            return;
        }
        EntityOtherPlayerMP entityOtherPlayerMP = new EntityOtherPlayerMP(this.mc.theWorld, this.mc.thePlayer.getGameProfile());
        entityOtherPlayerMP.inventory = this.mc.thePlayer.inventory;
        entityOtherPlayerMP.inventoryContainer = this.mc.thePlayer.inventoryContainer;
        entityOtherPlayerMP.setPositionAndRotation(this.mc.thePlayer.posX, this.mc.thePlayer.getEntityBoundingBox().minY, this.mc.thePlayer.posZ, this.mc.thePlayer.rotationYaw, this.mc.thePlayer.rotationPitch);
        entityOtherPlayerMP.rotationYawHead = this.mc.thePlayer.rotationYawHead;
        entityOtherPlayerMP.setSneaking(this.mc.thePlayer.isSneaking());
        this.packets.clear();
        this.elapsed = MathUtils.getRandomInRange(2, 3);
    }

    @Override
    public void onDisable() {
        if (this.mc.theWorld == null) {
            return;
        }
        this.isEnabled = false;
        this.mc.theWorld.removeEntityFromWorld(-13376969);
        this.packets.forEach(this.mc.thePlayer.sendQueue.getNetworkManager()::sendPacket);
        this.packets.clear();
        this.locations.clear();
    }

    private boolean hasMoved() {
        return this.mc.thePlayer.posX != this.mc.thePlayer.prevPosX || this.mc.thePlayer.posY != this.mc.thePlayer.prevPosY || this.mc.thePlayer.posZ != this.mc.thePlayer.prevPosZ;
    }
}

